The objective of our case study is a comparative analysis of the two environments and to find out if there exists software performance regression between a dedicated server and the virtual environment. To analyze this, we divided our project into three research questions. Following the set up of the subject systems and data preprocessing, we used requests per minute as our independent variable and performance metrics as our dependent variables to answer our research questions. %Firstly, we observe if our models are transferable across the three chosen environments. Secondly, if the models can accurately predict counter values cross-servers. Lastly, if defect injection will generate similar performance metrics values compared   

\subsection{\textbf{Data Analysis}}
Following the data transformation, we used R \cite{R} to derive conclusions for our research questions with the help of Spearman correlation, q-q plots \cite{qqplots}; a graphical technique to detect if two sets of data belong to the same population, Mann-Whitney \textit{U} test \cite{mannwhitney}, and generalized linear regression models (GLM) \cite{SanFranciscoStateUniversity}. Spearman correlation is used to identify the level of association between two variables while Mann-Whitney \textit{U} test is used to verify the hypothesis that if the data sets belong to the same population.
%calculate the absolute deviation in a dataset from the median \cite{brownftest} \textcolor{red}{or instead brown forsythe test. enough already for rq1, discuss}. 
Both the aforementioned methods do not strictly assume that the ordinal data is normally distributed \cite{spearman} \cite{manutest}. Due to the size of our data, heat maps \cite{heatmaps} were used to visualize the correlations. We chose model-based analysis as they can support the automatic selection and detection of performance abnormalities between heterogeneous environments. \cite{Shang:2015:ADP:2668930.2688052}\cite{Nguyen:2012:ADP:2188286.2188344}. Contrary to the usual practice of ad-hoc selection of certain target performance metrics \cite{heger2013automated} to detect performance regression, we included the compete set of all 56 metrics to build our models. For our linear regression models, we processed our data in two steps. First, we remove any metrics that showed no variance by a R script, for example a metric which has less than 20 unique values \cite{rahm2000data}. Next, we also remove the metrics which have high correlation amongst themselves to remove any \textit{multicollinearity} present \cite{mansfield1982detecting} so that the models do not over fit based on similar predictors(performance metrics) for the load. This approach will also magnify the metric which actually contribute the most to the model. The rationale behind aforementioned steps was to clean up data that may not contribute significantly to the model \cite{Shihab:2010:UIC:1852786.1852792}. 


Once our data was organized our next step was to build the GLM using the physical and the virtual environment's performance metrics. Our models were built using the load as the dependent variable and the performance metrics as the independent variable i.e. the load is dependent on the change of values of the performance metrics. with the help. We, additionally, trained and tested our models for the same environment before using it cross-environments. This served as the benchmark for lower limit of the prediction percentage error. A model tested for the same environment was validated via ten-fold cross validation \cite{Cross_Validation} \cite{kohavi1995study}. Each fold is based on a random subset of values. The model is trained on 9 folds and tested on the $10^{th}$ fold. This is done 10 times with 10 different subsets of data each time. The accuracy of our models was determined by the percentage error of the predicted load versus the actual load values which was calculated as the absolute difference of the actual and predicted load values with respect to the actual load values.

Based on the results from the GLMs we then investigate about the metrics that are contributing the most and their respective correlation values using heat maps. Heat maps allow us to graphically view, in our case, the individual metrics and their correlation values. 

\subsection{\textbf{Do performance metrics from physical and virtual environments belong to the same population?}}

%\textbf{Motivation}: Performance assurance activities are not only bounded by the idea that performance regression can only be identified relative to different versions of the software. A software system might also regress once it is transferred from one environment to another. According to the norm, practitioners often rely on performance metrics generated by the virtual environment prior to releasing it on a disparate environment. We address this question by comparing the metric values between the physical and virtual server. 

%\textbf{Approach}: As mentioned earlier in Section 3, after setting up the subject systems, we used the number of requests as our workload for the systems. A script was written to randomly alter the workload after every minute for CloudStore and every two minutes for DS2. The script was based on an underlying assumption that every unit of change in the performance metrics there will be a consequent unit of change in the workload which eventually introduced variety in our dataset. \cite{linearregression}. Subsequently, the requests per minute were mapped against the performance metrics recorded via \textit{perfmon}.

%The numerical values for requests per minute were extracted out of the web server's access logs. These requests were recorded per second and reached up to thousands in a minute, depending on the workload. We then, with the aid of a script, grouped and extracted the requests per minute for as long as the test systems were exercised. The metrics, on the contrary, were recorded every 10 seconds. A set of six records was averaged out as a minute according to the timestamps. This was called a single \textit{run}. The metrics generated for the web and database server were concatenated. Ultimately, we had a dataset consisting of 500 runs where every record represented a \textit{run}; the metrics and requests generated for a given minute. This process was carried out for both of our environments. The two datasets, to analyze any discrepancies, were then analyzed using R's q-q plots and \textit{cor} function.

\begin{figure}[thb]
	\centering
	\includegraphics[width=0.9\columnwidth]{figures/qqplots_DS2.pdf}
	\caption{Q-Q plots: DS2}
%	\captionsetup{justification=centering}
	\label{fig:Results Table}
\end{figure}



\begin{figure}[thb]
	\centering
	\includegraphics[width=0.9\columnwidth]{figures/qqplots_CS.pdf}
	\caption{Q-Q plots: CloudStore}
%	\captionsetup{justification=centering}
	\label{fig:Results Table}
\end{figure}

\begin{table}[tbh]
	\centering
	\caption{Results of Mann-Whitney \textit{U} test and Cliff Delta on Performance Metrics}
	\label{my-label}
	\resizebox{\columnwidth}{!}{%
		\begin{tabular}{|c||c|c|c|c|c|}
			\hline 
			\multirow{2}{*}{\textbf{System}} & \multirow{2}{*}{\textbf{p\textgreater0.05}} & \multicolumn{4}{c|}{\textbf{p\textless0.05}} \\ \cline{3-6} 
			&  & \textbf{Neglible} & \textbf{Small} & \textbf{Medium} & \textbf{Large} \\ %\hline
			\midrule 
			\midrule 
			DS2 & 2 & 1 & 2 & 5 & 34 \\ \hline
			CloudStore & 0 & 0 & 3 & 1 & 40 \\ \hline
		\end{tabular}%
	}
\end{table}

% Please add the following required packages to your document preamble:
% \usepackage{multirow}
% \usepackage{graphicx}
\begin{table}[thb]
	\centering
	\caption{Correlation and p-values of highlighted Performance Metrics}
	\label{my-label}
	\resizebox{\columnwidth}{!}{%
		\begin{tabular}{|c||c|c|c|c|}
			\hline
			\multirow{2}{*}{\textbf{Performance Metrics}} & \multicolumn{2}{c|}{\textbf{DS2}} & \multicolumn{2}{c|}{\textbf{CloudStore}} \\ \cline{2-5} 
			& \textbf{Cor} & \textbf{p-value} & \textbf{Cor} & \textbf{p-value} \\ %\hline
			\midrule 
			\midrule 
			Web Servers' User Times & 0.08 & 0.07 & 0.01 & 0.87 \\ \hline
			DB Servers User Times & -0.05 & 0.30 & 0.20 & 0.00 \\ \hline
			Web Servers' IO Data Ops/sec & 0.25 & 0.00 & 0.17 & 0.00 \\ \hline
			DB Servers' IO Data Ops/sec & -0.14 & 0.00 & 0.18 & 0.00 \\ \hline
			Web Servers' Memory Working Set & 0.22 & 0.00 & 0.69 & 0.00 \\ \hline
			DB Servers' Memory Working Set & 0.46 & 0.00 & -0.13 & 0.00 \\ \hline
		\end{tabular}%
	}
\end{table}

\begin{table}[tbh]
	\centering
	\caption{Correlation of All the Performance Metrics}
	\label{my-label}
	\resizebox{\columnwidth}{!}{%
		\begin{tabular}{|c||c|c|c|c|c|}
			\hline
			\multirow{3}{*}{\textbf{System}} & \multirow{3}{*}{\textbf{p\textgreater0.05}} & \multicolumn{4}{c|}{\textbf{p\textless0.05}} \\ \cline{3-6} 
			&  & \multicolumn{4}{c|}{\textbf{Cor}} \\ \cline{3-6} 
			&  & \textbf{0.0$\sim$0.3} & \textbf{0.3$\sim$0.5} & \textbf{0.5$\sim$0.7} & \textbf{0.7$\sim$1} \\ %\hline
			\midrule 
			\midrule 
			\textbf{DS2} & 8 & 28 & 4 & 0 & 1 \\ \hline
			\textbf{CloudStore} & 6 & 25 & 3 & 4 & 3 \\ \hline
		\end{tabular}%
	}
\end{table}

%\begin{table}[t]
%	\centering
%	\caption{DS2: Correlation Values}
%	\label{resultRQ3}
%	\begin{tabular}{c|cc}
%		\toprule
%		\textbf{Performance Metrics}   & \textbf{Cor} & \textbf{p-value}\\  
%		\midrule 
%		\midrule 
%		\textbf{Web Servers' User Times} & \ 0.08 & 0.07\\
%		\textbf{DB Servers' User Times} & -0.05 & 0.30\\
%		\midrule 
%		\textbf{Web Servers' IO Data Ops/Sec}   &\ 0.25 & 0.000 \\
%		\textbf{DB Servers' IO Data Ops/Sec} & -0.14 & 0.00\\
%		\midrule 
%		\textbf{Web Servers' Memory Working Set} &\ 0.22 & 0.00\\
%		\textbf{DB Servers' Memory Working Set} &\ 0.46 & 0.00\\
%		\bottomrule             
%	\end{tabular}
%\end{table}
%	
%\begin{table}[t]
%		\centering
%		\caption{CloudStore: Correlation Values}
%		\label{resultRQ3}
%		\begin{tabular}{c|cc}
%			\toprule
%			\textbf{Performance Metrics}   & \textbf{Cor}& \textbf{p-value}\\
%			\midrule 
%			\midrule 
%			\textbf{Web Servers' User Times} & \ 0.01& 0.87\\
%			\textbf{DB Servers' User Times} & \ 0.20 & 0.00\\
%			\midrule 
%			\textbf{Web Servers' IO Data Ops/Sec}   & \ 0.17& 0.00 \\
%			\textbf{DB Servers' IO Data Ops/Sec} & \ 0.18& 0.00\\
%			\midrule 
%			\textbf{Web Servers' Memory Working Set} &\ 0.69& 0.00\\
%			\textbf{DB Servers' Memory Working Set} & -0.13 & 0.00\\
%			\bottomrule             
%		\end{tabular}
%\end{table}

%\begin{figure}[t!]
%	\centering
%	\includegraphics[width=0.7\textwidth]{private_bytes.pdf}
%	\caption{QQ-plot of Private Bytes of Physical vs. Virtual Environment}
%	\captionsetup{justification=centering}
%	\label{fig:Results Table}
%\end{figure}

%\textbf{Approach}: 
%Following our data preprocessing, we decided to use Q-Q plot to identify if there exists a similarity between the distribution of our counters for the dedicated and the virtual server. We divided our metrics into three sub-categories namely \textit{processor, IO and memory}.

Figure 2 and 3 show the results from our Q-Q plots generated for both of our environments. Due to the limited space, we chose one Q-Q plot to be displayed from each subset of metrics i.e. CPU, IO and memory. If the distributions of our performance metrics were similar, we should the points lying on roughly a straight line \cite{qq_plots}.

As seen in Figure 2 for the subject system DS2, the CPU user times for the web servers are closer to the line Z however the plots database servers' CPU user times are highly deviated from the same line as it not visible in the same plot. The disk IO operations/sec for the web servers gradually deviate form the line Z whereas the database server is, again, highly deviated. The same can be concluded about the memory working sets for both of our environments.
Figure 3 shows the q-q plots for CloudStore. The web servers CPU user times are not congruent with the line Z. The database server CPU user times towards the tail of the plot are closer to the line Z however they still do not follow the line Z. The disk IO operations for both servers tends to follow the line Z initally but gradually moves away. Further on, the memory working set for both of our servers, as seen, are distant to the line Z.

Table I shows the results of our Mann-Whitney \textit{U} Tests. However, even if the distributions are different, the difference can be negligible. To find out the quantitative difference between the two non-identical distributions  we used Cliff's Delta \cite{cliffsdeltajack}. We did not apply this technique on counters such as \textit{elapsed time, handle count, creating process ID, ID process, thread count} and \textit{priority base} as the do not contribute to the conclusions of the performance tests. We labeled them as NA(not applicable) in our table. The results showed that most of the performance metrics did not belong to the same distribution and have a significant difference.

Table 2 and 3 shows the Spearman correlation values between the selected performance metrics. If the correlation value is closer to 1 the metrics have a strong correlation and if the value is closer to 0 the metrics have a weak correlation. A negative correlation means that if one of the metrics is increasing in value, the other is decreasing. For both of our subject systems we observe that the correlation values are mostly positive and are closer to 0 representing weak correlations. This conclusion, however, is not applicable to the user times from both environments as the p-value $>$ 0.05.

\subsection{\textbf{Is the correlation value between load and performance metrics same cross-environments?}}

\textbf{Motivation}: Building on the conclusion from the previous research question, we next address the change in metric correlation values amongst themselves and versus the load. Our goal was to explore whether the change in correlation cross-environments is identical for both of our subject systems. This way we will be able to conclude whether a certain type of discrepancy is always present between the two environments or is it the unstable nature of the performance of subject systems in different environments. 
%Before the software is deployed in a physical environment, the performance analyst relies on the heuristics generated from the virtual environment \cite{foo2010mining}. One of the approaches to detect performance regression is to compare every metric with the previously passed performance test \cite{Shang:2015:ADP:2668930.2688052}. As discussed in our previous research question, most of the performance metrics between two environments do not belong to the similar distribution. 

%As discussed in RQ1, we discovered that our comparison of performance metrics between our physical and virtual environments produced dissimilar results. Our next step was to explore what metrics changed the most 


%As performance testing spans our from handful of hours to several days , the reliability on such exercise is remarkably critical. A recent bug fix or a modification may require a reiteration of performance tests \cite{foo2010mining}. On the contrary, This led us to our next question, that whether the performance assurance activities run on virtual environments can be duplicated.

\textbf{Approach}: We looked for the top 5 metrics which are highly correlated with the load in each of our environments. We used R's \textit{cor} function to determine the Spearman value of the aforementioned associations. 
Next, we used heat maps to highlight the set of metrics which show a significant change in correlation values amongst themselves.
The correlation values between the metrics of physical server were stored in matrix A. The correlation values between the metrics of the virtual server were store in matrix B. Matrix Z was the absolute difference between these two matrices. For example the Spearman correlation value for CloudStore's physical server between web server's User Time and database server's IO write/Bytes sec is 0.94. The correlation value for the same pair of metrics in the virtual environment is 0.26. Then the Matrix Z will record a value which is the absolute difference of the aforementioned Spearman values i.e. 0.68. If the metric value has changed significantly, according to the legend, this will be denoted as a 'hot zone' in the heatmap denoted by a lighter gradient of color.

\textbf{Results}: Figure 4 and 5 are the heatmaps for the change in correlation values amongst the metrics of two environments. For DS2, figure 4, the hot spots are mostly prevalent between the IO operations, for both the web and database server, cross-environments. This means the correlations amongst IO operations in the physical environment are not the same as the correlation between IO operations in the virtual environment. While CloudStore's heatmap, figure 5, shows that the change in correlation values is not as similar to DS2. Most of the hot spots are scattered across the heatmaps, contrary to DS2 where we can see clusters around most of the IO operations. 

We also observed a similar change in correlation values between the processor times and other metrics. This trend may not be as strong as CloudStore's heatmap for DS2, however these changes in values can be found in both of our subject system.

Table 3-6 are the top five highly correlated metrics with the load. In DS2, most of the IO operations from the web driver are highly correlated with the load in the physical environment. However, the database server is highly correlated than any of the metrics from the web driver in the virtual environment.
Table 5 and 6 shows a much similar behavior of CloudStore in both the environments.

We primarily learned that the DS2 IO operations' behavior in one environment are not similar to that of the physical environment. We also learned that the change in nature of correlation cross-environments is non-uniform.
%Figure 4 and 5 are the heatmaps for the change in correlations' values between the metrics of two environments. For DS2, figure 4, 4he hot spots are mostly prevalent between the IO operations cross-environment while CloudStore's heatmap, figure 5, shows that the change in correlation values is not as similar to DS2. Most of the hot spots are scattered across the heatmaps, contrary to DS2 where we can see clusters around most of the IO operations.



\begin{figure}[tbh]
	\centering	
	\includegraphics[width=0.5\textwidth]{figures/ds2_smaller_new.png}
	\caption{Heatmap: DS2}
%	\captionsetup{justification=centering}
	\label{fig:Results Table}
\end{figure}

\begin{figure}[tbh]
	\centering
	{\includegraphics[width=\columnwidth]{figures/cloudstore_heatmap_smaller_new.png}}
	\caption{Heatmap: CloudStore}
	%\captionsetup{justification=centering}
	\label{fig:Results Table}
\end{figure}


%\begin{table}[tbh]
%		\centering
%		\caption{DS2: Top 5 highly correlated metrics with load (Physical Server)}
%		\label{resultRQ3}
%		\begin{tabular}{c}
%			\toprule
%			1. Web Server IO Other Operations/sec \\
%			2. Web Server IO Other Bytes/sec \\
%			3. Web Server IO Write Operations/sec \\
%			4. Web Server IO Data Operations/sec \\
%			5. Web Server IO Data Bytes/sec \\
%			
%			\bottomrule             
%		\end{tabular}
%\end{table}


% Please add the following required packages to your document preamble:
% \usepackage{graphicx}
\begin{table*}[tbh]
	\centering
	\caption{DS2: Top 10 highly correlated metrics with load (Physical Server)}
	\label{my-label}
	\resizebox{\textwidth}{!}{%
		\begin{tabular}{|c||c|c|c|c|}
			\hline
			\textbf{Rank} & \textbf{Performance Metrics} & \textbf{Cor in Physical Environment} & \textbf{Cor in Virtual Environment} & \textbf{Rank in Virtual Environment} \\ %\hline
			\midrule
			\midrule
			1 & Web Server IO Other Ops/sec & 0.91 & 0.62 & 10 \\ \hline
			2 & Web Server IO Other Bytes/sec & 0.91 & 0.62 & 12 \\ \hline
			3 & Web Server IO Write Ops/sec & 0.91 & 0.63 & 9 \\ \hline
			4 & Web Server IO Data Ops/sec & 0.91 & 0.63 & 8 \\ \hline
			5 & Web Server IO Write Bytes/sec & 0.90 & 0.62 & 11 \\ \hline
			6 & Web Server IO Data Bytes/sec & 0.90 & 0.61 & 13 \\ \hline
			7 & DB Server IO Other Ops/sec & 0.84 & 0.75 & 3 \\ \hline
			8 & DB Server IO Data Ops/sec & 0.83 & 0.07 & 41 \\ \hline
			9 & DB Server IO Other Bytes/sec & 0.83 & 0.15 & 40 \\ \hline
			10 & DB Server IO Read Ops/sec & 0.82 & 0.05 & 15 \\ \hline
		\end{tabular}%
	}
\end{table*}


%\begin{table}[tbh]
%	\centering
%		\caption{DS2: Top 5 highly correlated metrics with load (Virtual Server)}
%		\label{resultRQ3}
%		\begin{tabular}{c}
%			\toprule
%			1. Database Server Handle Count \\
%			2. Database Server Working Set-Peak \\
%			3. Database Server Pool Paged Bytes \\
%			4. Database Server IO Other Operations/sec \\
%			5. Database Server Page File Bytes Peak \\
%			\bottomrule             
%		\end{tabular}
%\end{table}

% Please add the following required packages to your document preamble:
% \usepackage{graphicx}
\begin{table*}[tbh]
	\centering
	\caption{DS2: Top 10 highly correlated metrics with load (Virtual Server)}
	\label{my-label}
	\resizebox{\textwidth}{!}{%
		\begin{tabular}{|c||c|c|c|c|}
			\hline
			\textbf{Rank} & \textbf{Performance Metrics} & \textbf{Cor in Virtual Environment} & \textbf{Cor in Physical Environment} & \textbf{Rank in Physical Environment} \\ %\hline
			\midrule
			\midrule
			1 & DB Server Working Set Peak & 0.76 & NA & NA \\ \hline
			2 & DB Server Pool Paged Bytes & 0.75 & 0.30 & 20 \\ \hline
			3 & DB Server IO Other Ops/sec & 0.75 & 0.84 & 7 \\ \hline
			4 & DB Server Virtual Bytes Peak & 0.71 & NA & NA \\ \hline
			5 & DB Server Page File Bytes Peak & 0.71 & NA & NA \\ \hline
			6 & DB Server Working Set & 0.63 & 0.21 & 23 \\ \hline
			7 & DB Server Working Set Private & 0.63 & 0.21 & 24 \\ \hline
			8 & Web Server IO Data Ops/sec & 0.63 & 0.91 & 4 \\ \hline
			9 & Web Server IO Write Ops/sec & 0.63 & 0.91 & 3 \\ \hline
			10 & Web Server IO Other Ops/sec & 0.63 & 1 & 0.91 \\ \hline
		\end{tabular}%
	}
\end{table*}


%\begin{table}[tbh]
%	\centering
%		\caption{CloudStore: Top 5 highly correlated metrics with load (Physical Server)}
%		\label{resultRQ3}
%		\begin{tabular}{c}
%			\toprule
%			1. Database Server IO Other Bytes/sec  \\
%			2. Database Server IO Read Operations/sec   \\
%			3. Database Server IO Read Bytes/sec \\
%			4. Database Server IO Data Operations/sec    \\
%			5. Database Server IO Write Operations/sec \\
%			\bottomrule             
%		\end{tabular}
%\end{table}
%

\begin{table*}[tbh]
	\centering
	\caption{CloudStore: Top 10 highly correlated metrics with load (Physical Server)}
	\label{my-label}
	\resizebox{\textwidth}{!}{%
		\begin{tabular}{|c||c|c|c|c|}
			\hline
			\textbf{Rank} & \textbf{Performance Metrics} & \textbf{Cor in Physical Environment} & \textbf{Cor in Virtual Environment} & \textbf{Rank in Virtual Environment} \\ %\hline
			\midrule
			\midrule
			1 & DB Server IO Other Bytes/sec & 0.98 & 0.73 & 10 \\ \hline
			2 & DB Server IO Read Ops/sec & 0.98 & 0.84 & 7 \\ \hline
			3 & DB Server IO Read Bytes/sec & 0.98 & 0.93 & 5 \\ \hline
			4 & DB Server IO Data Ops/sec & 0.98 & 0.92 & 6 \\ \hline
			5 & DB Server IO Write Ops/sec & 0.98 & 0.97 & 2 \\ \hline
			6 & DB Server IO Data Bytes/sec & 0.98 & 0.96 & 4 \\ \hline
			7 & DB Server IO Write Bytes/sec & 0.98 & 0.96 & 3 \\ \hline
			8 & Web Server IO Other Bytes/sec & 0.98 & 0.68 & 13 \\ \hline
			9 & DB Server IO Other Ops/sec & 0.98 & 0.98 & 1 \\ \hline
			10 & Web Server IO Other Ops/sec & 0.98 & 0.70 & 14 \\ \hline
		\end{tabular}%
	}
\end{table*}


%\begin{table}[tbh]
%	\centering
%		\caption{CloudStore: Top 5 highly correlated metrics with load (Virtual Server)}
%		\label{resultRQ3}
%		\begin{tabular}{c}
%			\toprule
%			1. Database Server IO Other Operations/sec  \\
%			2. Database Server IO Write Operations/sec   \\
%			3. Database Server IO Write Bytes/sec \\
%			4. Database Server IO Data Bytes/sec    \\
%			5. Database Server IO Read Bytes/sec \\
%			\bottomrule             
%		\end{tabular}
%\end{table}

% Please add the following required packages to your document preamble:
% \usepackage{graphicx}
\begin{table*}[tbh]
	\centering
	\caption{CloudStore: Top 10 highly correlated metrics with load (Virtual Server)}
	\label{my-label}
	\resizebox{\textwidth}{!}{%
		\begin{tabular}{|c||c|c|c|c|}
			\hline
			\textbf{Rank} & \textbf{Performance Metrics} & \textbf{Cor in Virtual Environment} & \textbf{Cor in Physical Environment} & \textbf{Rank in Physical Environment} \\ %\hline
			\midrule
	     	\midrule
			1 & DB Server IO Other Ops/sec & 0.98 & 0.98 & 9 \\ \hline
			2 & DB Server IO Write Ops/sec & 0.97 & 0.98 & 5 \\ \hline
			3 & DB Server IO Write Bytes/Sec & 0.96 & 0.98 & 7 \\ \hline
			4 & DB Server IO Data Bytes/sec & 0.96 & 0.98 & 6 \\ \hline
			5 & DB Server IO Read Bytes/sec & 0.93 & 0.98 & 3 \\ \hline
			6 & DB Server IO Data Ops/sec & 0.93 & 0.98 & 4 \\ \hline
			7 & DB Server IO Read Ops/sec & 0.84 & 0.98 & 2 \\ \hline
			8 & DB Server User Time & 0.79 & 0.90 & 21 \\ \hline
			9 & DB Server Processor Time & 0.77 & 0.92 & 20 \\ \hline
			10 & DB Server IO Other Bytes/sec & 0.73 & 0.98 & 1 \\ \hline
		\end{tabular}%
	}
\end{table*}


\subsection{\textbf{Do performance metrics from different environments impact performance modeling?}}

\textbf{Motivation}: As discussed in earlier work \cite{Shang:2015:ADP:2668930.2688052} \cite{Nguyen:2012:ADP:2188286.2188344}, performance tests require a large dedication of resources as it is carried out just before the system is on the brink of deployment. This gives insufficient time to the performance engineers, leaving them with minimal resources. As a result they leverage on the performance assurance activities carried out in the virtual environment. The motivation behind this research question is to investigate whether the performance models generated from one environment can be applied and held representatives of the other. In essence, this will help the practitioners conclude the reliability of the performance activities carried out in the virtual environment. 
% In practice, this may or may not be appropriate to assume. This also spawns the concept of including the entire set of performance metrics for analysis, which is slipshod and ineffectual. 

\textbf{Approach}: We first validated our models with an environment using 10-fold cross validation. \textit{K}-fold cross validation divides the data into \textit{k} parts which are known as folds. The model is trained on \textit{k}-1 folds and tested on the \textit{k}$^{th}$ fold. This process is iteratively repeated \textit{k} times \cite{10foldcross} \cite{kohavi1995study}.


We partitioned our results into two segments; the explanatory and the predictive part for our models, trailed by applying our model to predict load cross-environments. The explanatory part calculates the percentage of deviance explained by our models i.e. the fit of the model while the predictive part explains the error percentage between the actual and predicted load values. Both of these parts were addressed by building generalized linear models that only incorporated the metrics which were selected via R \textit{stepwise stepwise} or commonly knows as \textit{stepwise} function, from the complete set of metrics from the dataset.

\textit{Explanatory Power}

After removing any outliers for both of our subject systems, we built our GLM, initially, using all the physical server's metrics. We trained and tested our model on the same server i.e. physical. We then reduced our model, iteratively, using only the metrics that our contributing the most to the model. This was achieved using R's \textit{stepwise} function. The \textit{stepwise} function adds the independent variables one by one to the model to exclude any metrics that not contributing to the model \cite{RInAction}. Once the metrics were automatically selected out on the physical server, we used R's \textit{ANOVA}, or \textit{analysis of deviance} to rank the metrics according to their deviance value. Higher the deviance value for a given performance metric in the model, higher the contribution of the performance metric to the model. This approach was similarly applied to the set of metrics from the virtual server to build a generalized linear model. R's \textit{deviancepercentage} was used to determine the explanatory part or fit of our model. It is used to calculate the percentage of deviance for a given GLM model.

As a result, we had two scenarios per subject system:
\begin{description}
	\item[$\bullet$] Trained on physical, tested on physical.
	\item[$\bullet$] Trained on virtual, tested on virtual.
\end{description} 

\textit{Predictive Power}
%\begin{description}
	
	%\paragraph{Cross-Environment}
	
	The notion behind our predictive approach was to observe the percentage error between the actual and the predicted load. Our first set of predicted values were based on the model trained on the virtual environment's performance metrics and tested on the physical's server metrics. For the dataset of the virtual metrics, we wrote a script in R to remove the metrics that indicated practically zero fluctuation because else they will not have any impact on the GLM. This was trailed by the step to remove any highly correlated metrics and using \textit{stepwise} for every fold \cite{Shihab:2010:UIC:1852786.1852792}. 
	%From the statistical techniques available to validate our model, we used 10-fold cross \cite{kohavi1995study} \cite{10foldcross}.
	We used mean absolute percentage error (\textit{MAPE}) to measure the error between the predicted and actual load values \cite{mape}. MAPE serves as the percentage measurement of the deviance of our forecasted values from our real values which makes it easier to interpret our results. If the error is 3, we say the forecasted value are off by 3\%. 
	
	Based on our results, we then also scaled the virtual environment's metrics according to the physical environment. Our approach for scaling was based on by Nguyen \textit{et al.} previous work \cite{Nguyen:2012:ADP:2188286.2188344}:
	%We addressed the presence of a high percentage error by adjusting our virtual environment's metrics to the phsyiscal environment according to the following equation:
	%As explained in RQ1, we perceived that our distributions generated by the performance metrics in our environments are not the same. We used R's \textit{predict} to predict our desired set of load, based on the training and testing mentioned in the previous subsections. \textcolor{red}{we used 1-fold cross validation here, necesaary to mention?}
	
	\begin{equation*}
	Load_{physical}= \alpha_{physical} \times Counter_{physical} + \beta_{physical}
	\end{equation*}
	
	\begin{equation*}
	Load_{virtual}= \alpha_{virtual} \times Counter_{virtual} + \beta_{virtual}
	\end{equation*}
	
	\begin{equation}
	V_{scaledmetric} = (\frac{Load_{virtual}-\beta_{virtual}}{\alpha_{virtual}})\times\alpha_{physical}+\beta_{physical}
	\end{equation}
	
To scale our metrics from the virtual environment, we first build a GLM with the selected counter and the load in the each of the environment. The selected counter was chosen on the basis of counters selected by \textit{stepwise}, trained in virtual and tested in phyiscal environment. For every GLM there exists an intercept and a gradient value. We used the aforementioned values and applied them to the metric from the virtual environment as explained by equation 1.
We also assumed that for each of the metric there will be a gradient and intercept value.
 %The selection of metrics was based on their presence in the GLMs that were trained in the virtual environment and tested in the physical environment.


 
\textbf{Results}: Tables 7-10 show the results of our approach. In Table 7, for our subject system DS2, we see that the statistically significant metrics for the GLM from both of our environments are different. The significant of the performance metrics in an GLM is environment dependent. Due to automatic selection of metrics we see a high fit and lower \textit{MAPE} values for our environments. Table 8 shows us the results when the model from the virtual was applied to predict load for the physical server and vice-versa. We observe a an immensely high \textit{MAPE} value for the former while physical-virtual prediction is almost 50\%. This means that the predicted and actual values of the workload have a mean absolute error percentage of almost 50\%. When the same set of metrics from the virtual environment were scaled the MAPE value for DS2 reduces drastically.


Table 9 shows us the results from CloudStore. Again, the ranks of the metrics that prove to contribute most to the model are not the same compared to both environments. After the data validation, we see a \textit{MAPE} value of almost 16\% for physical server and almost 5\% for virtual. As the GLM was based on automatic selection via \textit{stepwise} regression, we see a high percentage fit for our models. 
Table 10 shows us the results of cross application of models. A model that was trained on virtual server and tested to predict the workload values for the physical server was off by almost 29\% whereas from physical applied to virtual it was off by 293\%. Similarly, when the metrics were scaled, instead of a an expected decrease in the MAPE value we see that the MAPE jumps from 28.95\% to 276.04\%.

Not only the \textit{MAPE} values are high when applying models cross environments, they are inconsistent between two environments. We conclude that for both of our subject systems, the models can not directly be applied to predict load for the other environment. We also observed that scaling according to the physical environment may or may not work. This is dependent on the selection of metrics in both of the environments. What might be significant in on of the models may not be applicable to the other model in another environment.




%We obtained the former equations with the models by training and testing on the respective environments. These equations are derived from the previous work of \cite{Nguyen:2012:ADP:2188286.2188344} Once, the model was constructed we extracted the \(\alpha\) and \(\beta\) values from each model and applied them to scale the virtual environment's metrics accordingly. Equation (1) shows the derived equation through which we scaled the metrics during the process of scaling the counters. 


	%As shown in Table 3, we concluded that most of the contributions to our models are by \textit{DISC IO} and the \textit{CPU}. Inclusion of the aforementioned set of performance metrics gave us a fit percentage closer to the models which included all of the performance metrics. Additionally, the models that were based on the statistically significant metrics ranked by the other environment showed a MAPE value of no more than 7\%. This helped us conclude the metrics that are contributing the most between are environments are overlapping.  
	%The unscaled transfer of metrics generated a \textit{MAPE} value \textbf{40\%} more than that of scaled counters. Our approach successfully identified that the performance metrics generated in the virtual environment can not be taken as the exact reflection of the performance of the system in the physical environment. We also deduced the diversity in environment does impact the regression models and the performance assurance activities. One of the solution to counters this is scaling, however, the error still remains relatively high as shown in Table 2.
	
	%\afterpage{%
	%    \clearpage% Flush earlier floats (otherwise order might not be correct)
	%    \thispagestyle{empty}% empty page style (?)
	%    \begin{landscape}% Landscape page
	%        \centering % Center table
	%        \begin{tabular}{llll}
	%          \begin{table}[thb!]
	%    \begin{center}
	%    \caption{Results}
	%    \label{tab:project_results}
	%            \begin{tabular}{c||cccc}
	%            \toprule
	%            \textbf{Training-Testing}   & \textbf{Physical - Physical} & \textbf{Physical - Virtual} & \textbf{Virtual - Virtual} & \textbf{Virtual - Physical} \\  
	%            \midrule 
	%            \textbf{Ranking}     &       1. IO Read Bytes/sec & 1.IO Read Bytes/sec & 1.User Time  & 1.IO Read Operations/sec \\
	%             &                               2. IO Data Operations/sec & 2. IO Data Operations/sec & 2. IO Read Bytes/sec & 2. IO Read Operations/sec \\
	%             & 3.IO Read Operations/sec & 3.IO Other Bytes/sec & 3. IO Data Operations/sec & 3. IO Other Bytes/sec \\
	%             & 4. IO Other Bytes/sec & 4. IO Read Operations/sec & 4. IO Other Bytes/sec & 4. IO Write Bytes/sec\\
	%             & 5.IO Data Bytes/sec & & 5.Elapsed Time &\\
	%             & 6.Page Faults/sec & & 6.IO Read Operations/sec &\\
	%             & & & 7. Thread Count &\\
	%             & & & 8. IO Write Bytes/sec &\\
	%             & & & 9.IO Write Operations/sec &\\
	%             & & & 10. Working Set &\\
	%             \midrule
	%             \textbf{Fit} & All metrics: 64.1\% & All metrics: 81\% & All metrics: 81\% & All metrics: 63.4\%\\
	%             & Statistically Significant Metrics: 63.5\% & Statistically Significant Metrics: 81\% & Statistically Significant Metrics: 81\% & Statistically Significant Metrics: 63.2\% \\
	%             \midrule
	%             \textbf{MAPE} & 6.17\% & 3.81\% & 3.89\% & 6.14\% \\
	%            \bottomrule             
	%        \end{tabular}
	%    \end{center}
	%\end{table}
	%\\
	%        \end{tabular}
	%        \captionof{table}{Table caption}% Add 'table' caption
	%    \end{landscape}
	%    \clearpage% Flush page
	%}
	
%\end{description}
	
%\begin{landscape}
	\begin{table}[tbh]
		\centering
			\caption{DS2: Ranking of Performance Counters and Prediction errors}
			\label{tab:resultRQ1}
			\resizebox{\columnwidth}{!}{%
			\begin{tabular}{c||cc}
				\toprule
				\textbf{Training-Testing} & \textbf{Physical - Physical} & \textbf{Virtual - Virtual} \\  
				\midrule 
				\textbf{Ranking}     & 1. Web Server Privileged Time & 1. Web Server IO Other Bytes/sec \\
				\\
				& 2. Database Server User Time & 2. Web Server Page Faults/sec \\
				\\
				& 3. Database Server IO Read Bytes/sec & 3.Database Server Working Set-Peak\\
				\\
				& 4. Web Server Page Faults/sec & 4. Web Server Handle Count \\
				\\
				& 5. Database Server Privileged Time & 5. Database Server IO Data Operations Bytes/sec \\
				\\
				& 6. Database Server IO Write Operations Bytes/sec &\\
				\\
				& 7. Database Server Pool Paged Bytes &\\
				\\
				& 7. Web Server Working Set-Private &\\
				\\
				\midrule
				\textbf{Fit} &  85.80\% &  67.10\% \\
				\midrule
				\textbf{MAPE} & 7.02\% & 10.49\% \\
				\bottomrule             
		\end{tabular}%
	}
	\end{table}
%\end{landscape}


	\begin{table}[tbh]
		\centering
			\caption{DS2: Prediction errors cross-environments}
			\label{resultRQ3}
			\begin{tabular}{c|c}
				\toprule
				\textbf{Training - Testing}   & \textbf{MAPE}\\  
				\midrule 
				Physical-Virtual       & 49.97\% \\
				Virtual - Physical        & 6033.16\% \\
				Virtual - Physical \textbf{(after scaling)}      & 16.04\% \\
				\bottomrule             
			\end{tabular}
	\end{table}
	
	
	\begin{table}[tbh]
		\centering
			\caption{CloudStore: Ranking of Performance Counters and Prediction errors}
			\label{tab:resultRQ1}
			\resizebox{\columnwidth}{!}{%
				\begin{tabular}{c||cc}
					\toprule
					\textbf{Training-Testing} & \textbf{Physical - Physical} & \textbf{Virtual - Virtual} \\  
					\midrule 
					\textbf{Ranking}     & 1. Web Server Privileged Time & 1. Web Server IO Data Bytes/sec \\
					\\
					& 2. Database Server Privileged Time & 2. Database Server User Time \\
					\\
					& 3. Web Server Page Faults/sec & 3.Database Server IO Other Bytes/sec\\
					\\
					& 4. Web Server Virtual Bytes & 4.Database Server Page Faults/sec\\
					\\
					& 5. Database Server Pool Nonpaged Bytes & \\
					\\
					& 6. Database Server Page Faults/sec & \\
					\\
					& 7. Database Server Page File Bytes &\\
					\\
					& 8. Database Server Working Set &\\
					\\
					\midrule
					\textbf{Fit} &  85.20\% &  89.10\% \\
					\midrule
					\textbf{MAPE} & 15.75\% & 4.70\% \\
					\bottomrule             
				\end{tabular}%
			}
	\end{table}
	%\end{landscape}
	
	
	\begin{table}[tbh]
		\centering
			\caption{CloudStore: Prediction errors cross-environments}
			\label{resultRQ3}
			\begin{tabular}{c|c}
				\toprule
				\textbf{Training - Testing}  & \textbf{MAPE}\\  
				\midrule 
				Physical-Virtual       & 293.62\% \\
				Virtual - Physical      & 28.95\% \\
				Virtual - Physical \textbf{(after scaling)} & 276.04\% \\
				\bottomrule             
			\end{tabular}
	\end{table}
	
	
	
	%
	%\begin{table*}[thb!]
	%    \begin{center}
	%    \caption{Results}
	%    \label{tab:project_results}
	%            \begin{tabular}{l| c c r c || c c c || c c c}
	%            \toprule
	%            \textbf{}   & \thead{Release}  & \thead{\# of classes}   & \thead{SLOC} & \thead{\# of \\contributors}  & \thead{\# of \\comments}   & \thead{\# of \\comments \\after filtering} & \thead{\# of \\TD \\comments} & \thead{\% of \\Design \\Debt} & \textbf{\% of Requirement Debt} & \thead{\% of \\Other \\Debts}\\ 
	%            \midrule 
	%            \textbf{Ranking}            & 1.7.0    & 1,475 & 115,881 & 74  & 21,587 &   4,137 &    131 &  72.51  & 09.92  & 17.55 \\
	%            ArgoUML        & 0.34     & 2,609 & 176,839 & 87  & 67,716 &   9,548 &  1,413 &  56.68  & 29.08  & 14.22 \\
	%            Columba        & 1.4      & 1,711 & 100,200 & 9   & 33,895 &   6,478 &    204 &  61.76  & 21.07  & 17.15 \\
	%            EMF            & 2.4.1    & 1,458 & 228,191 & 30  & 25,229 &   4,401 &    104 &  75.00  & 15.38  & 09.61 \\
	%            Hibernate      & 3.3.2 GA & 1,356 & 173,467 & 226 & 11,630 &   2,968 &    472 &  75.21  & 13.55  & 11.22 \\
	%            JEdit          & 4.2      &   800 &  88,583 & 57  & 16,991 &  10,322 &    256 &  76.56  & 05.46  & 17.96 \\
	%            JFreeChart     & 1.0.19   & 1,065 & 132,296 & 19  & 23,474 &   4,423 &    209 &  88.03  & 07.17  & 04.78 \\
	%            Jmeter         & 2.10     & 1,181 &  81,307 & 33  & 20,084 &   8,162 &    374 &  84.49  & 05.61  & 09.89 \\
	%            JRuby          & 1.4.0    & 1,486 & 150,060 & 328 & 11,149 &   4,897 &    622 &  55.14  & 17.68  & 27.17 \\ 
	%            SQuirrel       & 3.0.3    & 3,108 & 215,234 & 46  & 27,474 &   7,230 &    286 &  73.07  & 17.48  & 09.44 \\ 
	%            \bottomrule             
	%        \end{tabular}
	%    \end{center}
	%\end{table*}
	
	


%We retested our virtual and physical environments with a same set of load. As this experiment was a replica of our previous research question, our approach was based on the same lines. After obtaining the performance metrics, we preprocessed our data where every record represented the load and performance metrics generated for a minute. We removed the first thirty entries, which represented first thirty minutes in our tests to remove any noise.  After the preprocessing phase we had three set of metrics for every environment. We labeled one of them as the \textit{baseline metrics} and the rest as \textit{reference metrics 1} and \textit{reference metrics 2}. Succeedingly, these six datasets were imported in R for further analysis.
%To draw conclusion and validate the findings, firstly we removed any metric that showed no variance. This is pursued by removing metrics which are highly correlated with other metrics in the same data set, for example \textit{Processor Time} and \textit{Privileged Time}. We, then, train our data bolstered by the generalized linear model. \textit{Stepwise Regression} is used to filter the metrics which do not contribute to our model. The metrics are added one by one to until no further contribution is made to the model.  \cite{RInAction}. We trained our model with the set of \textit{baseline metrics} and tested our model by predicting the load for the \textit{reference metrics 1} and \textit{reference metrics 2} . We trained iteratively on the rest of the sets of metrics and tested for the remaining two sets of metrics. We repeated this approach for both of our environments.
%We calculated the accuracy of our approach by the \textit{mean absolute percentage error} where the absolute difference of real and predicted values is divided by the real values followed by taking the mean. \cite{perfmon}

%\textbf{Results}:  We observed that \textit{MAPE} values for majority of our experiments run on physical environment fell under \textbf{30\%} while for the virtual the values were more than 200\%. 
%We also concluded that because of the presence of the noise and the irregular behavior of the virtual environment, the experiments did not produce exact similar set of results. The difference in behavior was based on inconsistent \textit{User Time} and \textit{DISC IO} operations. This lead our to our next question that whether the performance testing done in virtual environment can be calibrated and applied to the physical environment, as profoundly practiced in the field of performance testing.

	
	
